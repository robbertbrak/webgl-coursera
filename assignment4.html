<!DOCTYPE html>
<html>
<head>

  <script id="vertex-shader" type="x-shader/x-vertex">

attribute vec4 vPosition;
attribute vec3 vNormal;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform vec4 lightPosition[4];

varying vec3 N;
varying vec4 L[4];
varying vec3 E;
varying vec3 fPosition;

void main() {
  vec3 pos = -(modelViewMatrix * vPosition).xyz;
  vec4 color = vec4(0.0, 0.0, 0.0, 1.0);
  vec4 NN = vec4(vNormal, 0);

  // Transform vertex normal into eye coordinates
  N = normalize((modelViewMatrix * NN).xyz);
  E = normalize(- pos);

  for (int i = 0; i < 4; i++) {
    vec3 light = lightPosition[i].xyz;
    L[i] = vec4(normalize(light - pos), lightPosition[i].w);
  }

  gl_Position = projectionMatrix * modelViewMatrix * vPosition;
}

  </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
precision mediump float;

uniform vec4 ambientProduct;
uniform vec4 diffuseProduct;
uniform vec4 specularProduct;
uniform vec4 baseColor;
uniform float materialShininess;
uniform float constantAttenuation;
uniform float linearAttenuation;
uniform float quadraticAttenuation;

varying vec3 N;
varying vec4 L[4];
varying vec3 E;

void main() {

  vec4 ambient = ambientProduct;
  vec4 fColor = vec4(0.0, 0.0, 0.0, 1.0);

  for (int i = 0; i < 4; i++) {
    if (L[i].w == 1.0) {
      vec3 H = normalize(L[i].xyz + E);

      float distance = length(L[i].xyz - E);
      float Kd = max(dot(L[i].xyz, N), 0.0);
      vec4 diffuse = Kd * diffuseProduct;

      float Ks = pow(max(dot(N, H), 0.0), materialShininess);
      vec4  specular = Ks * specularProduct;

      if (dot(L[i].xyz, N) < 0.0) {
        specular = vec4(0.0, 0.0, 0.0, 1.0);
      }

      float attenuation = 1.0 / (constantAttenuation + linearAttenuation * distance + (quadraticAttenuation * distance * distance));

      fColor = fColor + attenuation * diffuse + attenuation * specular;
    }
  }

  fColor = fColor + ambient;

  gl_FragColor = vec4(fColor.rgb, baseColor.a);
}
</script>

  <script type="text/javascript" src="common/webgl-utils.js"></script>
  <script type="text/javascript" src="common/initShaders.js"></script>
  <script type="text/javascript" src="common/MV.js"></script>
  <script type="text/javascript" src="assignment4-shapes.js"></script>
  <script type="text/javascript" src="assignment4.js"></script>
  <script type="text/javascript" src="common/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="common/spectrum.js"></script>
  <link rel="stylesheet" href="common/spectrum.css" />

  <style type="text/css">
    html, body { margin: 0; padding: 0; background-color: rgb(90, 90, 90); color: white;
      font-family: Arial, sans-serif; font-size: 12px; }
    .form-group { border: 1px solid white; padding: 3px; margin: 2px 0; }
    .form-group h3 { margin: 0;  font-size: 14px; }
    .form-element {  }
    label { display: inline-block; width: 120px; vertical-align: middle; line-height: 2.3em; }
    input, select { display: inline-block; vertical-align: middle; line-height: 2.3em; }
    input, select, button { font-size: 12px; }
    .slider { width: 250px; }
    .left-form { float: left; padding: 10px; min-width: 420px; max-width: 420px; }
    canvas { float: left; margin: 0; padding: 0; cursor: crosshair; }
    a { color: white; }
  </style>
</head>

<body>
<div class="left-form">
  <h2>Objects</h2>

  <div class="form-element">
    <label for="add-object">&nbsp;</label>
    <button id="add-object">Add object</button>
    <button id="remove-object">Remove object</button>
  </div>
  <div class="form-element">
    <label for="current-object">Current object:</label>
    <select id="current-object">
    </select>
  </div>
  <div class="form-element">
    <label for="shape">Shape</label>
    <select id="shape">
      <option value="sphere" selected="selected">Sphere</option>
      <option value="cylinder">Cylinder</option>
      <option value="cone">Cone</option>
      <option value="cube">Cube</option>
    </select>
  </div>
  <div class="form-group">
    <h3>Material properties</h3>
    <!--
    <div class="form-element">
      <label for="surfaceColor">Surface color</label>
      <input type="text" id="surfaceColor">
    </div>
    -->
    <div class="form-element">
      <label for="materialAmbient">Material ambient</label>
      <input type="text" id="materialAmbient">
    </div>
    <div class="form-element">
      <label for="materialDiffuse">Material diffuse</label>
      <input type="text" id="materialDiffuse">
    </div>
    <div class="form-element">
      <label for="materialSpecular">Material specular</label>
      <input type="text" id="materialSpecular">
    </div>

    <div class="form-element">
      <label for="materialShininess">Material shininess</label>
      <input type="range" class="slider" id="materialShininess" min="1" max="128" step="0.1" value="1">
    </div>
  </div>

  <div class="form-group">
    <h3>Scale</h3>
    <div class="form-element">
      <label for="scale">Scale</label>
      <input type="range" class="slider" id="scale" min="0.01" max="1.0" step="0.01" value="0">
    </div>
  </div>

  <div class="form-group">
    <h3>Rotation</h3>
    <div class="form-element">
      <label for="rotate-x">Rotate x</label>
      <input type="range" class="slider" id="rotate-x" min="0" max="360" step="1" value="0">
    </div>
    <div class="form-element">
      <label for="rotate-y">Rotate y</label>
      <input type="range" class="slider" id="rotate-y" min="0" max="360" step="1" value="0">
    </div>
    <div class="form-element">
      <label for="rotate-z">Rotate z</label>
      <input type="range" class="slider" id="rotate-z" min="0" max="360" step="1" value="0">
    </div>
  </div>

  <div class="form-group">
    <h3>Translation</h3>
    <div class="form-element">
      <label for="translate-x">Translate x</label>
      <input type="range" class="slider" id="translate-x" min="-1.0" max="1.0" step="0.001" value="0">
    </div>
    <div class="form-element">
      <label for="translate-y">Translate y</label>
      <input type="range" class="slider" id="translate-y" min="-1.0" max="1.0" step="0.001" value="0">
    </div>
    <div class="form-element">
      <label for="translate-z">Translate z</label>
      <input type="range" class="slider" id="translate-z" min="-1.0" max="1.0" step="0.001" value="0">
    </div>
  </div>

  <div class="form-group">
    <h3>Camera</h3>
    <div class="form-element">
      <label for="cameraAnimated">Animate</label>
      <input type="checkbox" id="cameraAnimated" checked>
    </div>
    <div class="form-element">
      <label for="cameraAngleY">Camera rotation</label>
      <input type="range" class="slider" id="cameraAngleY" min="0" max="360" step="1" value="45">
    </div>
  </div>

</div>

<canvas id="gl-canvas" width="700" height="700">
  Oops ... your browser doesn"t support the HTML5 canvas element
</canvas>

<div class="left-form">

  <h2>Lighting</h2>

  <div class="form-group">
    <h3>Distance attenuation</h3>
    <div class="form-element">
      <label for="constantAttenuation">Constant attenuation</label>
      <input type="range" class="slider" id="constantAttenuation" min="0" max="2" step="0.01" value="0">
    </div>
    <div class="form-element">
      <label for="linearAttenuation">Linear attenuation</label>
      <input type="range" class="slider" id="linearAttenuation" min="0" max="2" step="0.01" value="0">
    </div>
    <div class="form-element">
      <label for="quadraticAttenuation">Quadratic attenuation</label>
      <input type="range" class="slider" id="quadraticAttenuation" min="0" max="2" step="0.01" value="0">
    </div>
  </div>

  <div class="form-element">
    <label for="currentLight">Current light:</label>
    <select id="currentLight">
      <option value="0">Light 1</option>
      <option value="1">Light 2</option>
      <option value="2">Light 3</option>
      <option value="3">Light 4</option>
    </select>
  </div>

  <div class="form-element">
    <label for="lightOnOff">Enabled</label>
    <input type="checkbox" id="lightOnOff" checked>
  </div>

  <div class="form-element">
    <label for="lightAnimated">Animate</label>
    <input type="checkbox" id="lightAnimated">
  </div>

  <div class="form-group">
    <h3>Light position</h3>
    <div class="form-element">
      <label for="lightX">x</label>
      <input type="range" class="slider" id="lightX" min="-10.0" max="10.0" step="0.01" value="0">
    </div>
    <div class="form-element">
      <label for="lightY">y</label>
      <input type="range" class="slider" id="lightY" min="-10.0" max="10.0" step="0.01" value="0">
    </div>
    <div class="form-element">
      <label for="lightZ">z</label>
      <input type="range" class="slider" id="lightZ" min="-10.0" max="10.0" step="0.01" value="0">
    </div>
  </div>

  <div class="form-element">
    <h2>Instructions</h2>
    <p>
      Click 'Add object' to add an object to the canvas, then use the menu options to change its properties.
      Select a 'Current object' to change objects added earlier.
    </p>
    <p>
      Note: You <em>can</em> also click and drag on the canvas to move the object along the x and y axis, but the results
      might be unexpected due to camera rotation.
    </p>
    <p>
      Ctrl+Click and drag on the canvas is an alternative way to rotate an object along the x and y axis.
    </p>
  </div>
  <div class="footer">
    Tested in Chrome and Firefox.<br>
    Color picker: <a href="https://bgrins.github.io/spectrum/">https://bgrins.github.io/spectrum/</a>
  </div>


</div>


</body>
</html>
